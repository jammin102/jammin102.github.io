<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ì˜ ëª…ì–¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ì¶•í•˜ íš¨ê³¼ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.js"></script>
    <!-- HTML ìš”ì†Œë¥¼ ì´ë¯¸ì§€ë¡œ ìº¡ì²˜í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ì „ì—­ ë³€ìˆ˜ ì„¤ì • (Firebase ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤)
        window.firebase = {
            initializeApp,
            getAuth,
            signInAnonymously,
            signInWithCustomToken,
            onAuthStateChanged,
            getFirestore,
            collection,
            addDoc,
            onSnapshot,
            query,
            orderBy,
            limit
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;800;900&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            transition: background-color 0.5s ease-in-out;
        }
        #effect-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
        }
        
        #app-container {
            background-color: white; 
            z-index: 30; 
        }
        
        .result-card-container {
            background-color: white;
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .message-box {
            position: fixed;
            bottom: 22px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4f46e5;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
        }
        
        /* ì…ë ¥ í•„ë“œì˜ ê¸€ììƒ‰ì„ ë³´ì´ë„ë¡ ìœ ì§€ */
        #captcha-input {
            caret-color: #4f46e5; /* ì»¤ì„œëŠ” íŒŒë€ìƒ‰ìœ¼ë¡œ ë³´ì´ë„ë¡ ìœ ì§€ */
        }
        
        /* íƒ€ì´í•‘ ë¬¸ì¥ í‘œì‹œ ì˜ì—­ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        #typing-sentence-display {
            text-align: center; 
            line-height: 1.5;
            min-height: 56px;
        }
        
        /* ê¸€ì í”¼ë“œë°±ì„ ìœ„í•œ span ìŠ¤íƒ€ì¼ */
        #typing-sentence-display span {
            display: inline-block;
            transition: color 0.1s, background-color 0.1s;
            line-height: 1.5;
            /* ê¸°ë³¸ì ìœ¼ë¡œ íˆ¬ëª…í•œ ë°°ê²½ìœ¼ë¡œ ì„¤ì • */
            background-color: transparent; 
        }

    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 bg-gray-100" id="main-body">
    <!-- ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ìœ„í•œ ìº”ë²„ìŠ¤ -->
    <canvas id="effect-canvas"></canvas>
    
    <!-- ì„ì‹œ ë©”ì‹œì§€ ë°•ìŠ¤ -->
    <div id="tempMessage" class="message-box"></div>

    <!-- ì „ì²´ ì•± ì»¨í…Œì´ë„ˆ -->
    <div id="app-container" class="p-8 rounded-xl shadow-2xl w-full max-w-sm flex-shrink-0 border border-gray-200">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">ì˜¤ëŠ˜ì˜ ëª…ì–¸</h1>
        <p class="text-gray-500 text-center mb-6" id="main-description">ì•„ë˜ ë¬¸ì¥ì„ <strong class="text-blue-500">ì •í™•í•˜ê²Œ 3íšŒ</strong> ì…ë ¥í•˜ì—¬ ì˜¤ëŠ˜ì˜ í–‰ìš´ì„ ì ê¸ˆ í•´ì œí•˜ì„¸ìš”!</p>

        <div id="challenge-section" class="flex flex-col items-center mb-6">
            <!-- íƒ€ì´í•‘ ë¬¸ì¥ í‘œì‹œ ì˜ì—­: spanìœ¼ë¡œ ë™ì  ë¶„í• ë¨ -->
            <div id="typing-sentence-display" class="w-full text-center p-4 border-2 border-dashed border-blue-300 rounded-lg bg-blue-50 font-semibold text-lg text-gray-700 transition-all duration-300">ëª…ì–¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            <!-- ê²°ê³¼ ë©”ì‹œì§€ -->
            <p id="result-message" class="mt-4 text-sm font-medium h-5 text-gray-500"></p>
        </div>
        
        <div id="input-section" class="space-y-4">
            <!-- ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” í…ìŠ¤íŠ¸ ì…ë ¥ë€ -->
            <input type="text" id="captcha-input" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 shadow-sm placeholder-gray-400 focus:outline-none focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-shadow" placeholder="ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”." autocomplete="off">
        </div>

        <!-- ê²°ê³¼ ì •ë³´ ì„¹ì…˜ -->
        <div id="result-info" class="mt-6 hidden">
            <!-- ìº¡ì²˜ ì˜ì—­ ì‹œì‘: ì´ ì»¨í…Œì´ë„ˆë§Œ ìº¡ì²˜ ëŒ€ìƒì´ ë©ë‹ˆë‹¤. -->
            <div id="result-capture-card" class="result-card-container">
                <h2 class="text-2xl font-extrabold text-center mb-4 text-gray-800 border-b pb-2 border-blue-500">âœ¨ ì˜¤ëŠ˜ì˜ í–‰ìš´ ê²°ê³¼ âœ¨</h2>

                <!-- ê²°ê³¼ í•­ëª©ë“¤ -->
                <div class="space-y-3">
                    <!-- ì˜¤ëŠ˜ì˜ ëª©í‘œ -->
                    <div class="bg-red-100 p-3 rounded-lg shadow-md border border-red-300">
                        <p class="text-xs text-red-700 font-bold">ì˜¤ëŠ˜ì˜ ëª©í‘œ:</p>
                        <p id="goal-of-the-day" class="text-sm font-extrabold text-red-900 mt-1"></p>
                    </div>
                    
                    <!-- ì˜¤ëŠ˜ì˜ ëª…ì–¸ -->
                    <div class="bg-orange-100 p-3 rounded-lg shadow-md border border-orange-300">
                        <p class="text-xs text-orange-700 font-bold">ì˜¤ëŠ˜ì˜ ëª…ì–¸:</p>
                        <p id="quote-of-the-day" class="text-sm font-extrabold text-orange-900 mt-1"></p>
                    </div>

                    <!-- í–‰ìš´ì˜ ì½”ë“œ -->
                    <div class="bg-yellow-100 p-3 rounded-lg shadow-md border border-yellow-300">
                        <p class="text-xs text-yellow-700 font-bold">ì˜¤ëŠ˜ì˜ í–‰ìš´ì˜ ì½”ë“œ:</p>
                        <p id="lucky-code" class="text-xl font-extrabold text-yellow-900 mt-1"></p>
                    </div>
                    
                    <!-- ì˜¤ëŠ˜ì˜ ìš´ì„¸ -->
                    <div class="bg-lime-100 p-3 rounded-lg shadow-md border border-lime-300">
                        <p class="text-xs text-lime-700 font-bold">ì˜¤ëŠ˜ì˜ ìš´ì„¸:</p>
                        <p id="fortune-of-the-day" class="text-sm font-extrabold text-lime-900 mt-1"></p>
                    </div>

                    <!-- ì˜¤ëŠ˜ì˜ ì¡°ì–¸ -->
                    <div class="bg-blue-100 p-3 rounded-lg shadow-md border border-blue-300">
                        <p class="text-xs text-blue-700 font-bold">ì˜¤ëŠ˜ì˜ ì¡°ì–¸:</p>
                        <p id="advice-of-the-day" class="text-sm font-extrabold text-blue-900 mt-1"></p>
                    </div>
                    
                    <!-- ì˜¤ëŠ˜ì˜ ì¶”ì²œ ìŒì‹ -->
                    <div class="bg-purple-100 p-3 rounded-lg shadow-md border border-purple-300">
                        <p class="text-xs text-purple-700 font-bold">ì˜¤ëŠ˜ì˜ ì¶”ì²œ ìŒì‹:</p>
                        <p id="food-of-the-day" class="text-sm font-extrabold text-purple-900 mt-1"></p>
                    </div>

                    <!-- ì˜¤ëŠ˜ì˜ ìƒ‰ê¹” -->
                    <div id="color-section" class="p-3 rounded-lg shadow-md border transition-all duration-500 mt-3">
                        <p class="text-xs text-gray-700 font-bold">ì˜¤ëŠ˜ì˜ ìƒ‰ê¹”:</p>
                        <!-- ê¸€ì”¨ìƒ‰ë„ ìƒ‰ê¹” ë°°ê²½ì— ë§ê²Œ ë™ì ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤ -->
                        <p id="color-of-the-day" class="text-sm font-extrabold text-gray-900 mt-1"></p>
                    </div>
                </div>
            </div>
            <!-- ìº¡ì²˜ ì˜ì—­ ë -->

            <!-- ë³µì‚¬ ë° ì €ì¥ ë²„íŠ¼ ì„¹ì…˜ -->
            <div id="buttons-to-show" class="mt-4 space-y-2">
                <!-- ë³µì‚¬ ë²„íŠ¼ ëª©ë¡ -->
                <div class="grid grid-cols-3 gap-2 text-center text-xs">
                    <button id="copy-goal-button" class="py-2 bg-red-200 text-red-800 rounded-md hover:bg-red-300 transition-colors">ëª©í‘œ ë³µì‚¬</button>
                    <button id="copy-quote-button" class="py-2 bg-orange-200 text-orange-800 rounded-md hover:bg-orange-300 transition-colors">ëª…ì–¸ ë³µì‚¬</button>
                    <button id="copy-lucky-code-button" class="py-2 bg-yellow-200 text-yellow-800 rounded-md hover:bg-yellow-300 transition-colors">ì½”ë“œ ë³µì‚¬</button>
                    <button id="copy-fortune-button" class="py-2 bg-lime-200 text-lime-800 rounded-md hover:bg-lime-300 transition-colors">ìš´ì„¸ ë³µì‚¬</button>
                    <button id="copy-advice-button" class="py-2 bg-blue-200 text-blue-800 rounded-md hover:bg-blue-300 transition-colors">ì¡°ì–¸ ë³µì‚¬</button>
                    <button id="copy-food-button" class="py-2 bg-purple-200 text-purple-800 rounded-md hover:bg-purple-300 transition-colors">ìŒì‹ ë³µì‚¬</button>
                </div>

                <!-- ì´ë¯¸ì§€ ì €ì¥ ë²„íŠ¼ (ë¬¸êµ¬ ìˆ˜ì •) -->
                <button id="save-as-image-button" class="w-full bg-blue-500 text-white font-semibold py-3 rounded-xl hover:bg-blue-600 transition-all transform hover:scale-[1.01] shadow-lg">ğŸ ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
            </div>
        </div>
    </div>
    
    <script>
        // --- ì „ì—­ ë³€ìˆ˜ ì„¤ì • ë° DOM ìºì‹± ---
        
        // DOM ìš”ì†Œ ìºì‹±
        const typingSentenceDisplay = document.getElementById('typing-sentence-display');
        const captchaInput = document.getElementById('captcha-input');
        const resultMessage = document.getElementById('result-message');
        const resultInfo = document.getElementById('result-info');
        const goalEl = document.getElementById('goal-of-the-day');
        const quoteEl = document.getElementById('quote-of-the-day');
        const fortuneEl = document.getElementById('fortune-of-the-day');
        const foodEl = document.getElementById('food-of-the-day');
        const adviceEl = document.getElementById('advice-of-the-day');
        const colorSection = document.getElementById('color-section');
        const colorEl = document.getElementById('color-of-the-day');
        const luckyCodeEl = document.getElementById('lucky-code');
        const mainBody = document.getElementById('main-body');
        const appContainer = document.getElementById('app-container');
        const saveAsImageButton = document.getElementById('save-as-image-button');
        const effectCanvas = document.getElementById('effect-canvas');
        const ctx = effectCanvas.getContext('2d');
        const challengeSection = document.getElementById('challenge-section');
        const inputSection = document.getElementById('input-section');
        const resultCaptureCard = document.getElementById('result-capture-card');
        const mainDescription = document.getElementById('main-description');

        // ë³µì‚¬ ë²„íŠ¼ ìºì‹±
        const copyGoalButton = document.getElementById('copy-goal-button');
        const copyQuoteButton = document.getElementById('copy-quote-button');
        const copyFortuneButton = document.getElementById('copy-fortune-button');
        const copyFoodButton = document.getElementById('copy-food-button');
        const copyAdviceButton = document.getElementById('copy-advice-button');
        const copyLuckyCodeButton = document.getElementById('copy-lucky-code-button');

        // ë‚œì´ë„ ê³ ì • (3íšŒ)
        const requiredTypings = 3; 
        
        // --- ì‹œí¬ë¦¿ ì½”ë“œ ê´€ë ¨ ìƒìˆ˜ ë° ìƒíƒœ ---
        const secretWord = 'ì–¼ìŒíë¸Œ102'; // ì‹œí¬ë¦¿ ì½”ë“œ
        const animationDelay = 100; // ì‹œí€€ì…œ ì• ë‹ˆë©”ì´ì…˜ ë”œë ˆì´ (ms)
        let isAnimating = false; // ì‹œí¬ë¦¿ ì• ë‹ˆë©”ì´ì…˜ ì§„í–‰ ì—¬ë¶€
        
        // ì „ì—­ ìƒíƒœ ë³€ìˆ˜
        let challengeSentences = [];
        let currentSentenceIndex = 0;
        let typedCount = 0;
        let animationFrameId = null; 
        let particles = []; 

        let db, auth;

        // --- ìƒìˆ˜ ë°ì´í„° (ì´ì „ê³¼ ë™ì¼) ---
        const baseClasses = 'flex items-center justify-center min-h-screen p-4 transition-colors duration-500';
        const backgroundColors = [
            'bg-gray-100', 'bg-green-100', 'bg-blue-100', 'bg-purple-100', 
            'bg-red-200', 'bg-teal-200',
            'bg-gradient-to-r from-pink-400 to-purple-500',
            'bg-gradient-to-r from-blue-600 to-green-400',
            'bg-gradient-to-r from-cyan-500 to-blue-500',
            'bg-gradient-to-r from-red-500 to-yellow-500',
            'bg-gradient-to-r from-teal-400 to-indigo-500',
            'bg-gradient-to-r from-orange-400 to-rose-500'
        ];

        const sentences = [
            "í–‰ë³µì€ ì„ íƒì´ë‹¤", "ë§ˆìŒ ê°€ëŠ” ëŒ€ë¡œ ê°€ë¼", "ì„±ê³µì€ íƒœë„ì— ë‹¬ë ¸ë‹¤", "ì˜¤ëŠ˜ì€ ì–´ì œë³´ë‹¤ ë‚˜ì€ ë‚˜", 
            "ê¿ˆì€ í˜„ì‹¤ì´ ëœë‹¤", "ë³€í™”ëŠ” ì‘ì€ ê²ƒì—ì„œ ì‹œì‘", "ë…¸ë ¥ì€ ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤", "í¬ê¸°í•˜ì§€ ë§ˆë¼",
            "ì¸ìƒì€ ì•„ë¦„ë‹¤ìš´ ì—¬í–‰ì´ë‹¤", "ê°€ì¥ ì–´ë‘ìš´ ë°¤ì´ ì§€ë‚˜ë©´ ìƒˆë²½ì´ ì˜¨ë‹¤", "ëª¨ë“  ê²ƒì€ ë³€í•œë‹¤",
            "ì˜¤ëŠ˜ ë‹¹ì‹ ì´ í•  ìˆ˜ ìˆëŠ” ìµœì„ ì„ ë‹¤í•˜ë¼", "ì§„ì •í•œ ê°€ì¹˜ëŠ” ë‚´ë©´ì˜ í‰í™”ì— ìˆë‹¤", "ì„±ì¥ì€ ê³ í†µ ë’¤ì— ì°¾ì•„ì˜¨ë‹¤",
            "ì§€ê¸ˆ ì´ ìˆœê°„ì´ ê°€ì¥ ì†Œì¤‘í•œ ì‹œê°„ì´ë‹¤", "ë¯¸ë˜ëŠ” ì˜¤ëŠ˜ ìš°ë¦¬ê°€ ë¬´ì—‡ì„ í•˜ëŠ”ê°€ì— ë‹¬ë ¤ìˆë‹¤",
            "ìƒˆë¡œìš´ ì‹œë„ëŠ” í•­ìƒ ê°€ì¹˜ ìˆëŠ” ê²½í—˜ì„ ì„ ì‚¬í•œë‹¤", "ì‘ì€ ì¹œì ˆì´ ì„¸ìƒì„ ë³€í™”ì‹œí‚¨ë‹¤",
            "ì§€ë‚˜ê°„ ì¼ì— ì–½ë§¤ì´ì§€ ì•Šê³  ì•ì„ ë°”ë¼ë³´ë¼", "ê°€ì¥ í° ëª¨í—˜ì€ ë‹¹ì‹ ì˜ ê¿ˆì„ í–¥í•´ ë‚˜ì•„ê°€ëŠ” ê²ƒì´ë‹¤"
        ];
        
        const quotes = [
            "ì‹œì‘ì´ ë°˜ì´ë‹¤", "ì¸ìƒì€ ìš©ê¸°ë‹¤", "ë°°ì›€ì€ ê¹¨ì–´ ìˆëŠ” ì˜í˜¼ì˜ ì¦ê±°ì›€ì´ë‹¤", 
            "ê³ ë‚œì˜ ì‹œê¸°ì— ë™ìš”í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì§„ì • ìœ„ëŒ€í•œ ì¸ë¬¼ì´ë‹¤", 
            "ê°€ì¥ í° ìœ„í—˜ì€ ìœ„í—˜ ì—†ëŠ” ì‚¶ì´ë‹¤", "í–‰ë³µì˜ ë¬¸ì´ í•˜ë‚˜ ë‹«íˆë©´ ë‹¤ë¥¸ ë¬¸ì´ ì—´ë¦°ë‹¤", 
            "ìì‹ ì„ ë¯¿ì–´ë¼", "íƒœì–‘ì„ ë°”ë¼ë³´ë¼", "ê¸¸ì´ ë§‰íˆë©´ ë‹¤ë¥¸ ê¸¸ì„ ì°¾ì•„ë¼",
            "ë³€í™”ë§Œì´ ì˜ì›í•œ ê²ƒì´ë‹¤", "ì‹œë ¨ì€ ìˆì–´ë„ ì‹¤íŒ¨ëŠ” ì—†ë‹¤", "ì‚¬ë‘ì€ ì‚¶ì˜ ê°€ì¥ í° ì¶•ë³µì´ë‹¤",
            "ìì‹ ì„ ì‚¬ë‘í•˜ëŠ” ê²ƒì´ ëª¨ë“  ê²ƒì˜ ì‹œì‘ì´ë‹¤", "ì˜¤ëŠ˜ì„ ì˜¨ì „íˆ ì‚´ì•„ë¼", "ëª¨ë“  ì¼ì—ëŠ” ë•Œê°€ ìˆë‹¤",
            "ê¸°íšŒëŠ” ì¼ì–´ë‚˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë§Œë“¤ì–´ë‚´ëŠ” ê²ƒì´ë‹¤.", "ì„±ê³µì€ ìµœì¢…ì ì¸ ê²ƒì´ ì•„ë‹ˆë©°, ì‹¤íŒ¨ëŠ” ì¹˜ëª…ì ì¸ ê²ƒì´ ì•„ë‹ˆë‹¤.",
            "ì²œ ë²ˆì„ ë„˜ì–´ì§€ê³  ë‹¤ì‹œ ì¼ì–´ì„œëŠ” ê²ƒì´ ìš©ê¸°ì´ë‹¤.", "ìš°ë¦¬ê°€ ë‘ë ¤ì›Œí•´ì•¼ í•  ê²ƒì€ ë‘ë ¤ì›€ ê·¸ ìì²´ë‹¤."
        ];
        
        const fortunes = [
            "ì˜¤ëŠ˜ì€ í–‰ìš´ì´ ë‹¹ì‹  í¸ì— ìˆìŠµë‹ˆë‹¤. ì‘ì€ ë„ì „ë„ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆì„¸ìš”. íŠ¹íˆ ë™ìª½ ë°©í–¥ì— ì¢‹ì€ ê¸°ìš´ì´ ìˆìŠµë‹ˆë‹¤.",
            "ì˜ˆìƒì¹˜ ëª»í•œ ê¸°íšŒê°€ ì°¾ì•„ì˜¬ ê²ƒì…ë‹ˆë‹¤. ì£¼ë³€ì„ ì˜ ì‚´í´ë³´ì„¸ìš”. ê·€ì¸ì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ì˜¤ë˜ëœ ë¬¸ì œì˜ í•´ê²°ì±…ì´ ë³´ì´ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ë§ˆìŒì„ ì—¬ìœ ë¡­ê²Œ ê°€ì§€ì„¸ìš”. ì˜¤í›„ 3ì‹œ ì´í›„ì— ì¢‹ì€ ì†Œì‹ì´ ìˆìŠµë‹ˆë‹¤.",
            "ë…¸ë ¥ì˜ ê²°ì‹¤ì´ ë¹›ì„ ë°œí•˜ëŠ” í•˜ë£¨ì…ë‹ˆë‹¤. ìŠ¤ìŠ¤ë¡œë¥¼ ì¹­ì°¬í•´ì£¼ì„¸ìš”. ì¬ë¬¼ìš´ì´ ë”°ë¥´ë‹ˆ íˆ¬ìì— ê´€ì‹¬ì„ ê°€ì ¸ë³´ì„¸ìš”.",
            "ìƒˆë¡œìš´ ì¸ì—°ì´ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ê¸ì •ì ì¸ ë§ˆìŒìœ¼ë¡œ ë‹¤ê°€ê°€ì„¸ìš”. ì˜ˆìƒì¹˜ ëª»í•œ ë§Œë‚¨ì´ ê¸°ì¨ì„ ì¤„ ê²ƒì…ë‹ˆë‹¤.",
            "ëª¸ê³¼ ë§ˆìŒì´ í¸ì•ˆí•œ í•˜ë£¨ê°€ ë  ê²ƒì…ë‹ˆë‹¤. íœ´ì‹ì„ ì·¨í•˜ë©° ì¬ì¶©ì „í•˜ì„¸ìš”. ê±´ê°• ìš´ì´ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤.",
            "ì–´ë ¤ì›€ì´ ì‚¬ë¼ì§€ê³  ìƒˆë¡œìš´ ê¸¸ì´ ì—´ë¦½ë‹ˆë‹¤. í¬ë§ì„ ìƒì§€ ë§ˆì„¸ìš”. ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ì§ê°ì´ ì˜³ìŠµë‹ˆë‹¤.",
            "ì˜¤ëŠ˜ì€ ì£¼ë³€ ì‚¬ëŒë“¤ì—ê²Œ ì¹œì ˆì„ ë² í’€ë©´ í° ë³µìœ¼ë¡œ ëŒì•„ì˜µë‹ˆë‹¤. ì„ í–‰ì„ ì‹¤ì²œí•˜ì„¸ìš”.",
            "ì ì‹œ í•˜ë˜ ì¼ì„ ë©ˆì¶”ê³  ìì‹ ì„ ëŒì•„ë³´ëŠ” ì‹œê°„ì´ í•„ìš”í•©ë‹ˆë‹¤. ê¸‰í•˜ê²Œ ì„œë‘ë¥´ë©´ ì†í•´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ê²°ì •ì„ ë‚´ë¦¬ê¸° ì „ì— í•œ ë²ˆ ë” ì‹ ì¤‘í•˜ê²Œ ìƒê°í•˜ëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì „ë¬¸ê°€ì˜ ì¡°ì–¸ì„ êµ¬í•´ë³´ì„¸ìš”.",
            "ì‘ì€ ì˜¤í•´ê°€ í° ë‹¤íˆ¼ìœ¼ë¡œ ë²ˆì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§ì„ ì¡°ì‹¬í•˜ê³  ìƒëŒ€ë°©ì˜ ì…ì¥ì„ ì´í•´í•˜ë ¤ ë…¸ë ¥í•˜ì„¸ìš”.",
            "ê¸°ëŒ€í–ˆë˜ ì¼ì´ í‹€ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„ˆë¬´ ì‹¤ë§í•˜ì§€ ë§ˆì„¸ìš”. ì´ëŠ” ë” ì¢‹ì€ ê²ƒì„ ìœ„í•œ ë°œíŒì…ë‹ˆë‹¤.",
            "ì£¼ë³€ì˜ ë‹¬ì½¤í•œ ìœ í˜¹ì— ë„˜ì–´ê°€ì§€ ì•Šë„ë¡ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. íŠ¹íˆ ê¸ˆì „ ê±°ë˜ë¥¼ ì¡°ì‹¬í•˜ì„¸ìš”.",
            "ìƒˆë¡œìš´ ì‹œì‘ì˜ ê¸°ìš´ì´ ê°•í•©ë‹ˆë‹¤. ë¯¸ë¤„ë’€ë˜ í”„ë¡œì íŠ¸ë‚˜ ê³µë¶€ë¥¼ ì‹œì‘í•˜ê¸°ì— ì™„ë²½í•œ ë‚ ì…ë‹ˆë‹¤.",
            "ìì‹ ê°ì„ ê°€ì§€ê³  ë‹¹ì‹ ì˜ ì˜ê²¬ì„ í‘œí˜„í•˜ì„¸ìš”. ì˜¤ëŠ˜ì€ ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ê°€ ë¹›ì„ ë°œí•˜ëŠ” ë‚ ì…ë‹ˆë‹¤."
        ];

        const advices = [
            "ì ê¹ì˜ íœ´ì‹ ì‹œê°„ì„ ê°€ì§€ë©° ì»¤í”¼ í•œ ì”ì˜ ì—¬ìœ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”. ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œì— ë„ì›€ì´ ë©ë‹ˆë‹¤.",
            "ì˜¤ëŠ˜ í•  ì¼ì„ ë¯¸ë¦¬ ì •ë¦¬í•˜ê³  ì¤‘ìš”í•œ ì¼ë¶€í„° ì‹œì‘í•˜ë©´ í•˜ë£¨ê°€ í¸ì•ˆí•©ë‹ˆë‹¤. To-Do ë¦¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”.",
            "ì‘ì€ ì„±ì·¨ë¼ë„ ìŠ¤ìŠ¤ë¡œë¥¼ ì¹­ì°¬í•´ì£¼ë©° ê¸ì •ì ì¸ ê¸°ìš´ì„ ë†’ì—¬ë³´ì„¸ìš”. ìê¸° íš¨ëŠ¥ê°ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
            "ì˜¤ëœë§Œì— ì—°ë½í•˜ì§€ ëª»í•œ ì‚¬ëŒì—ê²Œ ë¨¼ì € ì•ˆë¶€ë¥¼ ì „í•´ë³´ì„¸ìš”. ê´€ê³„ê°€ ëˆë…í•´ì§ˆ ê²ƒì…ë‹ˆë‹¤.",
            "ìƒˆë¡œìš´ ì¥ì†Œë‚˜ ê¸¸ì„ ê±¸ìœ¼ë©° ì¼ìƒì— ì‹ ì„ í•¨ì„ ë”í•´ë³´ì„¸ìš”. ëœ»ë°–ì˜ ì•„ì´ë””ì–´ê°€ ë– ì˜¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ëª¸ì„ ê°€ë³ê²Œ ì›€ì§ì´ëŠ” ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ í™œë ¥ì„ ë˜ì°¾ì•„ë³´ì„¸ìš”. íŠ¹íˆ ëª©ê³¼ ì–´ê¹¨ë¥¼ í’€ì–´ì£¼ì„¸ìš”.",
            "ì˜¤ëŠ˜ ê°ì‚¬í–ˆë˜ ì¼ í•œ ê°€ì§€ë¥¼ ë– ì˜¬ë¦¬ê³  ê¸°ë¡í•´ë³´ì„¸ìš”. í–‰ë³µ í˜¸ë¥´ëª¬ì´ ë¶„ë¹„ë©ë‹ˆë‹¤.",
            "ì–´ë ¤ìš´ ì¼ì´ ìˆë‹¤ë©´ í˜¼ì ê³ ë¯¼í•˜ì§€ ë§ê³  ì£¼ë³€ì— ë„ì›€ì„ ìš”ì²­í•˜ì„¸ìš”. í˜‘ì—…ì´ í•´ê²°ì±…ì…ë‹ˆë‹¤.",
            "ì§€ë‚˜ê°„ ì¼ì— ì—°ì—°í•˜ê¸°ë³´ë‹¤ í˜„ì¬ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. í˜„ì¬ì— ìµœì„ ì„ ë‹¤í•˜ì„¸ìš”.",
            "ìƒˆë¡œìš´ ì·¨ë¯¸ë¥¼ ì‹œì‘í•˜ë©° ìì‹ ë§Œì˜ ì¦ê±°ì›€ì„ ì°¾ì•„ë³´ì„¸ìš”. ì¼ê³¼ ì‚¶ì˜ ê· í˜•ì´ í•„ìš”í•©ë‹ˆë‹¤.",
            "ì˜¤ëŠ˜ì€ ë””ì§€í„¸ ë””í†¡ìŠ¤ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”. ì ì‹œ ìŠ¤ë§ˆíŠ¸í°ì„ ë©€ë¦¬í•˜ë©´ ì§‘ì¤‘ë ¥ì´ í–¥ìƒë©ë‹ˆë‹¤.",
            "ì˜¤ë«ë™ì•ˆ ë¯¸ë¤„ì™”ë˜ ì²­ì†Œë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”. ì£¼ë³€ í™˜ê²½ì´ ê¹¨ë—í•´ì§€ë©´ ë§ˆìŒë„ ì •ë¦¬ë©ë‹ˆë‹¤.",
            "ë§¤ì¼ 10ë¶„ì”© ë…ì„œë¥¼ í•˜ëŠ” ìŠµê´€ì„ ë“¤ì—¬ë³´ì„¸ìš”. ì§€ì‹ê³¼ ì˜ê°ì´ ìƒ˜ì†Ÿì„ ê²ƒì…ë‹ˆë‹¤."
        ];

        const goals = {
            morning: [
                "ì•„ì¹¨ ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ëª¸ ê¹¨ìš°ê¸° (5ë¶„)", "ì˜¤ëŠ˜ í•  ì¼ 3ê°€ì§€ ì‘ì„±í•˜ê¸°", "ë”°ëœ»í•œ ë¬¼ í•œ ì” ë§ˆì‹œê³  ì†Œí™” ê¸°ê´€ ê¹¨ìš°ê¸°", 
                "í–‡ë¹›ì„ ë³´ë©° 5ë¶„ ê±·ê¸°", "ê°ì‚¬í•œ ì¼ í•œ ê°€ì§€ ìƒê°í•˜ê³  ê¸°ë¡í•˜ê¸°", "ë‰´ìŠ¤ í—¤ë“œë¼ì¸ 3ê°€ì§€ ì½ê¸°"
            ],
            afternoon: [
                "10ë¶„ ë‚®ì  ë˜ëŠ” ëª…ìƒí•˜ê¸°", "ì ê¹ ì‚°ì±…í•˜ë©° ë°”ëŒ ì¬ê¸°", "ì±…ìƒ ì •ë¦¬í•˜ê³  ì—…ë¬´ í™˜ê²½ ê°œì„ í•˜ê¸°", 
                "ì¢‹ì•„í•˜ëŠ” ìŒì•… ë“¤ìœ¼ë©° ì§‘ì¤‘í•˜ê¸° (30ë¶„)", "ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ëª¸ì˜ ê¸´ì¥ í’€ê¸°", "ë¬¼ 500ml ë§ˆì‹œê¸°"
            ],
            evening: [
                "ì¼ê³¼ë¥¼ ë˜ëŒì•„ë³´ë©° ê¸°ë¡í•˜ê¸°", "ë‚´ì¼ í•  ì¼ ë¯¸ë¦¬ ì •ë¦¬í•˜ê³  ìš°ì„ ìˆœìœ„ ì •í•˜ê¸°", "ê°€ë²¼ìš´ ìš´ë™ìœ¼ë¡œ í•˜ë£¨ ë§ˆë¬´ë¦¬í•˜ê¸° (30ë¶„)", 
                "ë”°ëœ»í•œ ë¬¼ë¡œ ìƒ¤ì›Œí•˜ë©° í•˜ë£¨ì˜ í”¼ë¡œ í’€ê¸°", "ì¢‹ì•„í•˜ëŠ” ì±… 10ë¶„ ì½ê¸°", "ê°€ì¡±ì—ê²Œ ì‚¬ë‘í•œë‹¤ê³  ë§í•˜ê¸°"
            ]
        };

        const colors = [
            { name: "íŒŒë€ìƒ‰", meaning: "ë§ˆìŒì„ ì°¨ë¶„í•˜ê²Œ ê°€ë¼ì•‰íˆê³  í‰ì˜¨í•¨ì„ ê°€ì ¸ë‹¤ì¤ë‹ˆë‹¤", tailwindClass: "bg-blue-100", borderClass: "border-blue-300", textClass: "text-blue-900", buttonBg: "bg-blue-200", buttonText: "text-blue-800" },
            { name: "ë…¸ë€ìƒ‰", meaning: "ê¸ì •ì ì´ê³  í™œê¸°ì°¬ ê¸°ìš´ì„ ì¤ë‹ˆë‹¤ ìì‹ ê°ì„ ê°€ì§€ì„¸ìš”", tailwindClass: "bg-yellow-100", borderClass: "border-yellow-300", textClass: "text-yellow-900", buttonBg: "bg-yellow-200", buttonText: "text-yellow-800" },
            { name: "ì´ˆë¡ìƒ‰", meaning: "ìì—°ì˜ ì•ˆì •ê°ì²˜ëŸ¼ ë§ˆìŒì˜ í‰í™”ë¥¼ ì„ ë¬¼í•©ë‹ˆë‹¤", tailwindClass: "bg-green-100", borderClass: "border-green-300", textClass: "text-green-900", buttonBg: "bg-green-200", buttonText: "text-green-800" },
            { name: "ë³´ë¼ìƒ‰", meaning: "ì°½ì˜ë ¥ì„ ë†’ì—¬ì£¼ê³  ì˜ê°ì„ ë¶ˆì–´ë„£ìŠµë‹ˆë‹¤", tailwindClass: "bg-purple-100", borderClass: "border-purple-300", textClass: "text-purple-900", buttonBg: "bg-purple-200", buttonText: "text-purple-800" },
            { name: "ì£¼í™©ìƒ‰", meaning: "ìƒˆë¡œìš´ í™œë ¥ê³¼ ì—ë„ˆì§€ë¥¼ ë¶ˆì–´ë„£ëŠ” ìƒ‰ì…ë‹ˆë‹¤", tailwindClass: "bg-orange-100", borderClass: "border-orange-300", textClass: "text-orange-900", buttonBg: "bg-orange-200", buttonText: "text-orange-800" },
            { name: "í°ìƒ‰", meaning: "ìƒˆë¡œìš´ ì‹œì‘ì„ ì˜ë¯¸í•©ë‹ˆë‹¤ ê¹¨ë—í•œ ë§ˆìŒìœ¼ë¡œ ì¶œë°œí•˜ì„¸ìš”", tailwindClass: "bg-white", borderClass: "border-gray-300", textClass: "text-gray-900", buttonBg: "bg-gray-200", buttonText: "text-gray-700" },
            { name: "ë¶„í™ìƒ‰", meaning: "ë¶€ë“œëŸ¬ì›€ê³¼ ì‚¬ë‘ì´ í•„ìš”í•œ ì˜¤ëŠ˜, ë‹¹ì‹ ì„ ê°ì‹¸ì¤„ ê²ë‹ˆë‹¤", tailwindClass: "bg-pink-100", borderClass: "border-pink-300", textClass: "text-pink-900", buttonBg: "bg-pink-200", buttonText: "text-pink-800" },
            { name: "ë¹¨ê°„ìƒ‰", meaning: "ê°•í•œ ì—´ì •ê³¼ ì—ë„ˆì§€ë¥¼ ìƒì§•í•©ë‹ˆë‹¤", tailwindClass: "bg-red-100", borderClass: "border-red-300", textClass: "text-red-900", buttonBg: "bg-red-200", buttonText: "text-red-800" },
            { name: "ê°ˆìƒ‰", meaning: "ì•ˆì •ê°ê³¼ í¸ì•ˆí•¨ì„ ê°€ì ¸ë‹¤ì¤ë‹ˆë‹¤", tailwindClass: "bg-amber-100", borderClass: "border-amber-300", textClass: "text-amber-900", buttonBg: "bg-amber-200", buttonText: "text-amber-800" }
        ];

        
        const breakfastFoods = ["ë”°ëœ»í•œ ìŠ¤í”„ì™€ ë¹µ", "ì‹œë¦¬ì–¼", "ê³¼ì¼ ìŠ¤ë¬´ë””ì™€ ìƒŒë“œìœ„ì¹˜", "ì—ê·¸ ìŠ¤í¬ë¨ë¸”", "ì£½", "ìš”ê±°íŠ¸ì™€ ê²¬ê³¼ë¥˜", "ìƒëŸ¬ë“œì™€ ë‹­ê°€ìŠ´ì‚´"];
        const lunchFoods = ["ê¹€ì¹˜ì°Œê°œì™€ ë”°ëœ»í•œ ë°¥", "ëˆê¹ŒìŠ¤", "ìƒëŸ¬ë“œ íŒŒìŠ¤íƒ€", "ë¶€ëŒ€ì°Œê°œ", "ì´ˆë°¥", "ë¹„ë¹”ë°¥", "ëƒ‰ë©´", "ì œìœ¡ë³¶ìŒ"];
        const dinnerFoods = ["ì‚¼ê²¹ì‚´", "íŒŒìŠ¤íƒ€", "ì†Œê³ ê¸° ìŠ¤í…Œì´í¬", "ì¹˜í‚¨", "í”¼ì", "ë‹­ê°ˆë¹„", "ì˜¤ë¦¬ê³ ê¸°", "í•´ë¬¼ì°œ"];
        const nightSnackFoods = ["ë§¤ì½¤í•œ ë–¡ë³¶ì´", "ë¼ë©´", "ì¹˜ì¦ˆ ìŠ¤í‹±", "ë§¥ì£¼ì™€ ê°ìì¹©", "ìˆœëŒ€", "ì¡±ë°œ", "ê³¼ì¼"];

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function showTempMessage(message) {
            const msgBox = document.getElementById('tempMessage');
            msgBox.textContent = message;
            msgBox.style.opacity = '1';
            setTimeout(() => {
                msgBox.style.opacity = '0';
            }, 3000);
        }

        function getFoodRecommendation() {
            const currentHour = new Date().getHours();
            let foodRecommendation;
            
            if (currentHour >= 7 && currentHour < 12) {
                foodRecommendation = `ì•„ì¹¨: ${breakfastFoods[Math.floor(Math.random() * breakfastFoods.length)]}`;
            } else if (currentHour >= 12 && currentHour < 18) {
                foodRecommendation = `ì ì‹¬: ${lunchFoods[Math.floor(Math.random() * lunchFoods.length)]}`;
            } else if (currentHour >= 18 && currentHour < 21) {
                foodRecommendation = `ì €ë…: ${dinnerFoods[Math.floor(Math.random() * dinnerFoods.length)]}`;
            } else {
                foodRecommendation = `ì•¼ì‹: ${nightSnackFoods[Math.floor(Math.random() * nightSnackFoods.length)]}`;
            }
            return foodRecommendation;
        }

        function getGoalForTime() {
            const currentHour = new Date().getHours();
            if (currentHour >= 5 && currentHour < 12) {
                return goals.morning[Math.floor(Math.random() * goals.morning.length)];
            } else if (currentHour >= 12 && currentHour < 18) {
                return goals.afternoon[Math.floor(Math.random() * goals.afternoon.length)];
            } else {
                return goals.evening[Math.floor(Math.random() * goals.evening.length)];
            }
        }
        
        // --- íƒ€ì´í•‘ ë¬¸ì¥ í‘œì‹œ ì„¤ì • í•¨ìˆ˜ (spanìœ¼ë¡œ ë¶„í• ) ---
        function setupTypingDisplay(sentence) {
            let html = '';
            for (const char of sentence) {
                let content = char;
                let extraClasses = '';
                if (char === ' ') {
                    content = '&nbsp;'; // ê³µë°±ì€ &nbsp;ë¡œ ì²˜ë¦¬í•˜ê³  ë³„ë„ í´ë˜ìŠ¤ ë¶€ì—¬
                    extraClasses = 'w-2'; 
                }
                // ì´ˆê¸°ì— í…ìŠ¤íŠ¸ëŠ” íšŒìƒ‰ìœ¼ë¡œ ì„¤ì •í•˜ê³ , íŠ¸ëœì§€ì…˜ í´ë˜ìŠ¤ ì¶”ê°€
                html += `<span class="text-gray-700 transition-colors duration-50 ${extraClasses}">${content}</span>`;
            }
            typingSentenceDisplay.innerHTML = html;
            // flexë¥¼ ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸ê°€ ì¤„ë°”ê¿ˆë˜ì–´ë„ ì¤‘ì•™ì— ëª¨ì´ë„ë¡ ì„¤ì •
            typingSentenceDisplay.classList.add('flex', 'flex-wrap', 'items-center', 'justify-center');
            typingSentenceDisplay.style.textAlign = 'center'; 
        }

        // --- ì‹¤ì‹œê°„ íƒ€ì´í•‘ í”¼ë“œë°± ë Œë”ë§ í•¨ìˆ˜ ---
        function renderTypingFeedback(userInput, correctSentence) {
            const spans = typingSentenceDisplay.querySelectorAll('span');
            const inputLength = userInput.length;
            
            spans.forEach((span, index) => {
                // Tailwind í´ë˜ìŠ¤ë¥¼ ì´ˆê¸°í™”í•˜ê³  ê¸°ë³¸ íŠ¸ëœì§€ì…˜ í´ë˜ìŠ¤ë§Œ ìœ ì§€
                span.className = 'transition-colors duration-50';
                
                // ê³µë°± ì²˜ë¦¬ ìœ ì§€ (HTML ìƒì˜ &nbsp;ì™€ w-2 í´ë˜ìŠ¤)
                if (correctSentence[index] === ' ') {
                    span.innerHTML = '&nbsp;';
                    span.classList.add('w-2');
                } else {
                    span.textContent = correctSentence[index];
                }

                if (index < inputLength) {
                    // ì…ë ¥ëœ ë¶€ë¶„ì— ëŒ€í•´ í”¼ë“œë°± ì ìš©
                    if (userInput[index] === correctSentence[index]) {
                        // ì¼ì¹˜: ì´ˆë¡ìƒ‰
                        span.classList.add('text-green-600', 'font-bold');
                    } else {
                        // ë¶ˆì¼ì¹˜: ë¹¨ê°„ìƒ‰
                        span.classList.add('text-red-600', 'font-bold');
                    }
                } else {
                    // ë¯¸ì…ë ¥ëœ ë¶€ë¶„: ê¸°ë³¸ íšŒìƒ‰
                    span.classList.add('text-gray-700');
                }
            });
        }
        
        // --- ì‹œí¬ë¦¿ ì½”ë“œ ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜ (ë¡œì§ì€ ë™ì¼í•˜ê²Œ ìœ ì§€) ---
        function startSecretAnimation(sentence, displayEl, callback) {
            isAnimating = true;
            
            // 1. ì¼ë°˜ í…ìŠ¤íŠ¸ ë¬¸ì¥ì„ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ span íƒœê·¸ë¡œ ë³€í™˜
            let html = '';
            for (const char of sentence) {
                let content = char;
                let extraClasses = '';
                if (char === ' ') {
                    content = '&nbsp;';
                    extraClasses = 'w-2';
                }
                // ì´ˆê¸°ì— í…ìŠ¤íŠ¸ëŠ” íšŒìƒ‰ìœ¼ë¡œ ì„¤ì •
                html += `<span class="text-gray-700 ${extraClasses}">${content}</span>`;
            }
            displayEl.innerHTML = html;
            displayEl.style.textAlign = 'center'; // ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì—ë„ ì¤‘ì•™ ì •ë ¬ ìœ ì§€
            
            const spans = displayEl.querySelectorAll('span');
            let index = 0;
            
            function colorNext() {
                if (index < spans.length) {
                    const span = spans[index];
                    
                    // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±° (í˜¹ì‹œ ë‚¨ì•„ìˆì„ í”¼ë“œë°± ì œê±°)
                    span.classList.remove('text-green-600', 'text-red-600', 'text-gray-700', 'font-bold');

                    if (span.textContent === '&nbsp;') { 
                        // ë„ì–´ì“°ê¸° ë¬¸ìëŠ” ì—°í•œ ë³´ë¼ìƒ‰ ë°°ê²½ìœ¼ë¡œ ì²˜ë¦¬
                        span.style.backgroundColor = '#ede9fe'; // ë³´ë¼ìƒ‰ ì—°í•œ ë°°ê²½
                        span.classList.add('text-transparent'); 
                    } else {
                        // ì¼ë°˜ ë¬¸ìëŠ” ë³´ë¼ìƒ‰ í…ìŠ¤íŠ¸ë¡œ ë³€ê²½
                        span.classList.add('text-purple-500');
                    }
                    
                    index++;
                    setTimeout(colorNext, animationDelay);
                } else {
                    // 2. ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ: ì½œë°± ì‹¤í–‰
                    if (callback) callback();
                    
                    // 3. ì ì‹œ í›„ ì´ˆê¸° ë””ìŠ¤í”Œë ˆì´ ìƒíƒœë¡œ ë³µêµ¬
                    setTimeout(() => {
                        isAnimating = false;
                        setupTypingDisplay(sentence); // ë‹¤ì‹œ span ë¶„í•  ìƒíƒœë¡œ ë³µêµ¬
                    }, 500); 
                }
            }
            colorNext();
        }

        // --- ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ í•¨ìˆ˜ (ì´ì „ê³¼ ë™ì¼) ---

        function createClover() {
            return {
                type: 'clover',
                x: Math.random() * effectCanvas.width,
                y: -10,
                size: Math.random() * 3 + 3,
                speed: Math.random() * 1.5 + 0.5,
                opacity: Math.random() * 0.5 + 0.5,
                rotation: Math.random() * 360,
                rotationSpeed: Math.random() * 1 - 0.5
            };
        }

        function drawClover(clover) {
            ctx.beginPath();
            ctx.fillStyle = `rgba(34, 139, 34, ${clover.opacity})`;
            
            const s = clover.size;
            ctx.save();
            ctx.translate(clover.x, clover.y);
            ctx.rotate(clover.rotation * Math.PI / 180);

            // ë„¤ì í´ë¡œë²„ ì ê·¸ë¦¬ê¸°
            for(let i = 0; i < 4; i++) {
                ctx.moveTo(0, 0);
                const angle = i * Math.PI / 2;
                ctx.arc(s * Math.cos(angle), s * Math.sin(angle), s, 0, 2 * Math.PI);
            }

            // ì¤„ê¸° ê·¸ë¦¬ê¸°
            ctx.fillRect(-1.5, s, 3, s * 2);
            
            ctx.restore();
            ctx.fill();
        }

        function animateParticles() {
            ctx.clearRect(0, 0, effectCanvas.width, effectCanvas.height);
            
            particles.forEach((particle, index) => {
                particle.y += particle.speed;
                particle.x += Math.sin(particle.y / 100) * 0.5;
                particle.rotation += particle.rotationSpeed;
                
                if (particle.y > effectCanvas.height) {
                    particles[index] = createClover();
                }

                drawClover(particle);
            });
            
            animationFrameId = requestAnimationFrame(animateParticles);
        }

        function startParticleAnimation() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            particles = []; 
            const count = 30; 

            for (let i = 0; i < count; i++) {
                particles.push(createClover());
            }
            animateParticles();
        }


        // --- í•µì‹¬ ë¡œì§ í•¨ìˆ˜ (ì´ì „ê³¼ ë™ì¼) ---

        function initTypingChallenge() {
            // ë¬¸ì¥ ëª©ë¡ì„ ê°€ì ¸ì™€ ì„ê³  í•„ìš”í•œ ê°¯ìˆ˜ë§Œí¼ ìë¦„
            challengeSentences = shuffleArray(sentences).slice(0, requiredTypings);
            
            // ìƒíƒœ ì´ˆê¸°í™”
            currentSentenceIndex = 0;
            typedCount = 0;
            isAnimating = false;
            
            // UI ì—…ë°ì´íŠ¸: ì²« ë¬¸ì¥ì„ span ë¶„í•  í˜•íƒœë¡œ ë Œë”ë§
            const currentSentence = challengeSentences[currentSentenceIndex];
            if (currentSentence) {
                setupTypingDisplay(currentSentence);
            } else {
                 typingSentenceDisplay.textContent = 'ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.';
            }

            resultMessage.textContent = `(${typedCount}/${requiredTypings}) ì •í™•íˆ ì…ë ¥í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”.`;
            resultMessage.className = 'mt-4 text-sm font-medium text-gray-500 h-5';
            captchaInput.value = '';
            
            // ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            resultInfo.classList.add('hidden');
            challengeSection.classList.remove('hidden');
            inputSection.classList.remove('hidden');
            mainDescription.classList.remove('hidden');
            
            // ì…ë ¥ í™œì„±í™”
            captchaInput.disabled = false;
            captchaInput.focus();
            
            // ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì§€
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null; 
                ctx.clearRect(0, 0, effectCanvas.width, effectCanvas.height);
            }

            // ë°°ê²½ìƒ‰ ì´ˆê¸°í™”
            mainBody.className = `${baseClasses} bg-gray-100`;
        }

        function clearChallenge() {
            // 1. ì¶•í•˜ íš¨ê³¼
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            // 2. ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ (í´ë¡œë²„)
            startParticleAnimation();

            // 3. ëœë¤ ë°°ê²½ìƒ‰ ë° ë°ì´í„° ìƒì„±
            const randomColorClass = backgroundColors[Math.floor(Math.random() * backgroundColors.length)];
            mainBody.className = `${baseClasses} ${randomColorClass}`;
            
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            const randomFortune = fortunes[Math.floor(Math.random() * fortunes.length)];
            const foodRecommendation = getFoodRecommendation();
            const randomAdvice = advices[Math.floor(Math.random() * advices.length)];
            const randomColorObject = colors[Math.floor(Math.random() * colors.length)];
            const randomGoal = getGoalForTime();
            
            // í–‰ìš´ì˜ ì½”ë“œ (ì›” * ì¼ * ë…„)
            const now = new Date();
            const luckyCode = (now.getMonth() + 1) * now.getDate() * now.getFullYear();
            
            const currentQuoteData = {
                goal: randomGoal,
                quote: randomQuote,
                fortune: randomFortune,
                food: foodRecommendation,
                advice: randomAdvice,
                color: randomColorObject,
                luckyCode: luckyCode,
                createdAt: Date.now()
            };
            
            // 4. UI ì—…ë°ì´íŠ¸: ê²°ê³¼ í‘œì‹œ
            goalEl.textContent = currentQuoteData.goal;
            quoteEl.textContent = `${currentQuoteData.quote}`;
            fortuneEl.textContent = currentQuoteData.fortune;
            luckyCodeEl.textContent = currentQuoteData.luckyCode;
            adviceEl.textContent = currentQuoteData.advice;
            foodEl.textContent = currentQuoteData.food;
            colorEl.textContent = `${currentQuoteData.color.name} (${currentQuoteData.color.meaning})`;
            
            // ì˜¤ëŠ˜ì˜ ìƒ‰ê¹” ì„¹ì…˜ ìŠ¤íƒ€ì¼ ë³€ê²½ (ë™ì  ìƒ‰ìƒ ì ìš©)
            colorSection.className = `p-3 rounded-lg shadow-md mt-3 border transition-all duration-500 ${currentQuoteData.color.tailwindClass} ${currentQuoteData.color.borderClass}`;
            colorEl.className = `text-sm font-extrabold ${currentQuoteData.color.textClass}`;

            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ ë° ì…ë ¥ ì„¹ì…˜ ìˆ¨ê¹€
            resultInfo.classList.remove('hidden');
            challengeSection.classList.add('hidden');
            inputSection.classList.add('hidden');
            mainDescription.classList.add('hidden');

            captchaInput.disabled = true;

            // ì¶”ê°€: ê²°ê³¼ ë°ì´í„°ë¥¼ Firestoreì— ì €ì¥ (ì„ íƒ ì‚¬í•­)
            saveResultToFirestore(currentQuoteData);
        }

        function saveResultToFirestore(data) {
            if (db && auth && auth.currentUser) {
                const userId = auth.currentUser.uid;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const path = `/artifacts/${appId}/users/${userId}/typing-results`;
                
                try {
                    const collectionRef = window.firebase.collection(db, path);
                    window.firebase.addDoc(collectionRef, data);
                    console.log("Result saved to Firestore.");
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
            } else {
                console.warn("Firestore not ready or user not authenticated. Skipping save.");
            }
        }

        // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        
        // ë³µì‚¬ ë¡œì§ í†µí•© í•¨ìˆ˜ (ì´ì „ê³¼ ë™ì¼)
        function setupCopyButton(button, element, successMessage) {
            button.addEventListener('click', () => {
                const textToCopy = element.textContent;
                if (textToCopy) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showTempMessage(successMessage);
                    }).catch(() => {
                        const tempInput = document.createElement('textarea');
                        tempInput.value = textToCopy;
                        document.body.appendChild(tempInput);
                        tempInput.select();
                        try {
                            document.execCommand('copy');
                            showTempMessage(successMessage);
                        } catch (err) {
                            console.error('Copy failed:', err);
                        }
                        document.body.removeChild(tempInput);
                    });
                }
            });
        }


        window.onload = function() {
            // ìº”ë²„ìŠ¤ í¬ê¸° ì´ˆê¸°í™” ë° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ì„¤ì •
            effectCanvas.width = window.innerWidth;
            effectCanvas.height = window.innerHeight;

            window.onresize = () => {
                effectCanvas.width = window.innerWidth;
                effectCanvas.height = window.innerHeight;
            };

            initTypingChallenge();

            // ì´ë¯¸ì§€ ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ì „ê³¼ ë™ì¼)
            saveAsImageButton.addEventListener('click', () => {
                const elementToCapture = resultCaptureCard;
                
                const buttonsToHide = document.getElementById('buttons-to-show');
                const saveButton = document.getElementById('save-as-image-button');
                
                // ìº¡ì²˜ ì‹œ ë¶ˆí•„ìš”í•œ ìš”ì†Œ ìˆ¨ê¹€
                buttonsToHide.style.display = 'none';
                saveButton.style.display = 'none';

                html2canvas(elementToCapture, { 
                    backgroundColor: '#ffffff', 
                    useCORS: true,
                    scale: 3 
                }).then(canvas => {
                    // ìº¡ì²˜ í›„ ìš”ì†Œ ë‹¤ì‹œ í‘œì‹œ
                    buttonsToHide.style.display = 'grid';
                    saveButton.style.display = 'block';

                    const image = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.href = image;
                    link.download = 'ì˜¤ëŠ˜ì˜_ëª…ì–¸_ê²°ê³¼.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    showTempMessage('ì´ë¯¸ì§€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œ ë˜ì—ˆìŠµë‹ˆë‹¤! (ê²°ê³¼ ì¹´ë“œë§Œ)');
                }).catch(error => {
                    // ì˜¤ë¥˜ ë°œìƒ ì‹œ ìš”ì†Œ ë‹¤ì‹œ í‘œì‹œ
                    buttonsToHide.style.display = 'grid';
                    saveButton.style.display = 'block';
                    console.error("Image saving failed:", error);
                    showTempMessage('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                });
            });

            // ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì‹¤ì‹œê°„ í”¼ë“œë°± ë° ì „ì²´ ë¬¸ì¥ ì¼ì¹˜ í™•ì¸)
            captchaInput.addEventListener('input', () => {
                const userInput = captchaInput.value;
                const correctSentence = challengeSentences[currentSentenceIndex];
                
                // ì• ë‹ˆë©”ì´ì…˜ì´ ì§„í–‰ ì¤‘ì´ë©´ ì…ë ¥ì„ ë¬´ì‹œ
                if (isAnimating) return;

                // 1. ì‹¤ì‹œê°„ íƒ€ì´í•‘ í”¼ë“œë°± ë Œë”ë§ (ìƒ‰ê¹”ë§Œ ë³€ê²½)
                renderTypingFeedback(userInput, correctSentence);
                
                // 2. ì‹œí¬ë¦¿ ì½”ë“œ ì…ë ¥ ì‹œ (ì…ë ¥ê°’ ì „ì²´ë¡œ í™•ì¸)
                if (userInput === secretWord) {
                    captchaInput.disabled = true;
                    // ì‹œí¬ë¦¿ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                    startSecretAnimation(correctSentence, typingSentenceDisplay, () => {
                         captchaInput.value = '';
                         clearChallenge();
                    });
                    return; 
                }

                // 3. ì „ì²´ ì…ë ¥ ì™„ë£Œ ë° ì¼ì¹˜ ì²´í¬ (í•µì‹¬ ì„±ê³µ ì¡°ê±´)
                if (userInput === correctSentence) {
                    captchaInput.disabled = true; // ì ì‹œ ì…ë ¥ ë°©ì§€
                    
                    resultMessage.textContent = 'í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…';
                    resultMessage.className = 'mt-4 text-sm font-bold text-green-600 h-5';
                    
                    typedCount++;
                    
                    setTimeout(() => {
                        captchaInput.value = '';
                        if (typedCount >= requiredTypings) {
                            clearChallenge();
                        } else {
                            currentSentenceIndex++;
                            
                            // ë‹¤ìŒ ë¬¸ì¥ ë¡œë“œ ë° span ë¶„í• 
                            setupTypingDisplay(challengeSentences[currentSentenceIndex]); 
                            
                            resultMessage.textContent = `(${typedCount}/${requiredTypings}) ì„±ê³µ! ë‹¤ìŒ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”.`;
                            resultMessage.className = 'mt-4 text-sm font-bold text-blue-600 h-5';
                            captchaInput.disabled = false; // ë‹¤ì‹œ í™œì„±í™”
                            captchaInput.focus();
                        }
                    }, 200); 

                } else if (userInput.length > correctSentence.length) {
                    // 4. ì…ë ¥ ê¸¸ì´ê°€ ì •ë‹µ ë¬¸ì¥ë³´ë‹¤ ê¸¸ ê²½ìš°
                    // í”¼ë“œë°±ì€ renderTypingFeedbackì—ì„œ ì´ë¯¸ ì²˜ë¦¬ë¨. ì—¬ê¸°ì„œëŠ” ë©”ì‹œì§€ë§Œ í‘œì‹œ.
                    resultMessage.textContent = 'ì…ë ¥ ê¸¸ì´ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. âŒ';
                    resultMessage.className = 'mt-4 text-sm font-bold text-red-600 h-5';
                } else {
                    // 5. ì •ìƒì ìœ¼ë¡œ ì…ë ¥ ì¤‘ì¼ ê²½ìš° (ìƒ‰ê¹” í”¼ë“œë°±ì€ renderTypingFeedbackì—ì„œ ì²˜ë¦¬)
                    resultMessage.textContent = `(${typedCount}/${requiredTypings}) ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.`;
                    resultMessage.className = 'mt-4 text-sm font-medium text-gray-500 h-5';
                }
            });

            // ë¶™ì—¬ë„£ê¸° ë°©ì§€ (ì´ì „ê³¼ ë™ì¼)
            captchaInput.addEventListener('paste', (e) => {
                e.preventDefault();
                showTempMessage('âš ï¸ ë¶™ì—¬ë„£ê¸°ëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            });

            // ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (ì´ì „ê³¼ ë™ì¼)
            setupCopyButton(copyGoalButton, goalEl, 'ì˜¤ëŠ˜ì˜ ëª©í‘œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            setupCopyButton(copyQuoteButton, quoteEl, 'ëª…ì–¸ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            setupCopyButton(copyFortuneButton, fortuneEl, 'ìš´ì„¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            setupCopyButton(copyFoodButton, foodEl, 'ìŒì‹ ì¶”ì²œì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            setupCopyButton(copyAdviceButton, adviceEl, 'ì˜¤ëŠ˜ì˜ ì¡°ì–¸ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            setupCopyButton(copyLuckyCodeButton, luckyCodeEl, 'í–‰ìš´ì˜ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // --- Firebase ì´ˆê¸°í™” ë° ì¸ì¦ (ì´ì „ê³¼ ë™ì¼) ---
            try {
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

                if (Object.keys(firebaseConfig).length > 0) {
                    const app = window.firebase.initializeApp(firebaseConfig);
                    auth = window.firebase.getAuth(app);
                    db = window.firebase.getFirestore(app);

                    window.firebase.onAuthStateChanged(auth, async (user) => {
                        if (!user) {
                            try {
                                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                                if (initialAuthToken) {
                                    await window.firebase.signInWithCustomToken(auth, initialAuthToken);
                                } else {
                                    await window.firebase.signInAnonymously(auth);
                                }
                            } catch (error) {
                                console.error("Firebase Auth Error:", error);
                            }
                        }
                    });
                }
            } catch (error) {
                console.error("Firebase Initialization Failed:", error);
            }
        }
    </script>
</body>
</html>
